version: 0.2

phases:
  install:
    commands:
      - yum install -y curl
      - export ORIG_DIR=$(pwd)
      - cd /tmp
      - curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
      - chmod +x ./kubectl
      - mv ./kubectl /usr/local/bin/kubectl
      - kubectl version
      - cd $ORIG_DIR
      - pwd
  build:
    commands:
      - docker build . -t 391324319136.dkr.ecr.us-west-2.amazonaws.com/snippetbox-server:$(date +%s%N) -f deploy/docker/server/Dockerfile
